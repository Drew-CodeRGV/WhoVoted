<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) --> 
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JR8NZLG3T6"></script> 
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-JR8NZLG3T6');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Politiquera.Com - Voting & Election Info</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-P26LYV7B8H"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-P26LYV7B8H');
    </script>

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Politiquera.Com - RGV Voting & Election Info">
    <meta property="og:description" content="Look up your neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <meta property="og:image" content="assets/thumbnail.jpg">
    <meta property="og:url" content="https://politiquera.com">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Politiquera.Com - Voting & Election Info">
    <meta name="twitter:description" content="Look up your RGV neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <meta name="twitter:image" content="assets/x-card.jpg">
    
    <!-- Standard Meta Tags -->
    <meta name="description" content="Look up your RGV neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <link rel="image_src" href="assets/thumbnail.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/thumbnail.jpg">
    
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    
    <!-- Leaflet Marker Cluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    
    <!-- Leaflet Marker Cluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    
    <!-- Leaflet Heat -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>    

    <!-- USA Flag Icon Marker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBsi0hqt44YuszCHWFo0QfDCtUWr8cqCj0&libraries=places,geocoding"></script>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />

    <style>
        /* District Control Styles */
        .district-control {
            padding: 10px;
            background: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            background-clip: padding-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .layer-control-box {
            padding: 6px 8px;
        }

        .layer-control-box h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }

        .control-toggle {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            margin-right: 10px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
        }

        .slider.round {
            border-radius: 20px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .opacity-control {
            margin-top: 10px;
        }

        .opacity-control label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 12px;
        }

        .opacity-control input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        #opacity-value {
            display: inline-block;
            width: 40px;
            text-align: right;
            font-size: 12px;
            color: #666;
        }

        .districts-legend {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .districts-legend h5 {
            margin: 0 0 5px 0;
            font-size: 12px;
            color: #666;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 2px 0;
            font-size: 11px;
            color: #666;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border: 1px solid rgba(0,0,0,0.2);
        }

        /* Map container style */
        #map {
            height: 100vh;
            width: 100%;
            z-index: 1;
        }

        /* Ensure popups appear above other elements */
        .leaflet-popup {
            z-index: 1000;
        }
    </style>

    <!-- Config file -->
    <script src="config.js"></script>
</head>
<body>   
    <img src="assets/politiquera.png" alt="Overlay" class="overlay-image">
    
    <!-- Welcome Popup -->
    <div class="welcome-popup" id="welcomePopup">
        <button class="close-button" onclick="document.getElementById('welcomePopup').style.display='none'">×</button>
        Welcome to Politiquera.com! This map shows you who has early-voted in Hidalgo & Cameron County according to their voter turnout rosters. Use this to see who's voted in your City, Community or on your block. If they haven't voted, you can use this as a conversation starter to encourage them to get out and vote! Thanks for visiting!
    </div>

    <!-- Search Container -->
    <div class="search-container">
        <input id="search-input" type="text" placeholder="Search for an address">
        <button class="search-button" id="search-button">Search</button>
        <button id="geolocation-button" class="geolocation-button" title="Find my location">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
            </svg>
        </button>
    </div>

    <!-- Map Options Panel - Top Right -->
    <div class="map-options-panel" style="position: fixed; top: 80px; right: 10px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); z-index: 1000; min-width: 240px;">
        <div class="map-options-header" style="display: flex; justify-content: space-between; align-items: center; padding: 12px 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px 8px 0 0; cursor: pointer;">
            <h3 style="margin: 0; font-size: 16px; font-weight: 600;">Map Options</h3>
            <button class="map-options-toggle" id="mapOptionsToggle" style="background: none; border: none; color: white; cursor: pointer; font-size: 16px; padding: 5px;">▼</button>
        </div>
        <div class="map-options-content" id="mapOptionsContent" style="padding: 15px;">
            <!-- Heatmap Type -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-label" style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Heatmap Type:</label>
                <div class="map-option-buttons" style="display: flex; gap: 8px;">
                    <button class="map-option-btn active" data-option="heatmap" data-value="traditional" style="flex: 1; padding: 8px 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: 2px solid #667eea; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; color: white; text-align: center;">
                        Turnout
                    </button>
                    <button class="map-option-btn" data-option="heatmap" data-value="party" style="flex: 1; padding: 8px 12px; background: white; border: 2px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; color: #555; text-align: center;">
                        Party
                    </button>
                </div>
            </div>

            <!-- Numeric Displays -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="numericDisplayToggle" checked style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Numeric Badges</span>
                </label>
            </div>

            <!-- Precinct Lines -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="precinctLinesToggle" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Draw Precinct Lines</span>
                </label>
            </div>

            <!-- Polling Locations -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="pollingLocationsToggle" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Polling Locations</span>
                </label>
            </div>

            <!-- County Boundaries -->
            <div class="map-option-section" style="margin-bottom: 0; padding-bottom: 0;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="countyBoundariesToggle" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show County Boundaries</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Dataset Selector Control -->
    <div class="dataset-selector-control">
        <label for="dataset-selector">Dataset:</label>
        <select id="dataset-selector" class="dataset-select">
            <option value="">Loading datasets...</option>
        </select>
        <div class="dataset-info">
            <span id="dataset-county"></span>
            <span id="dataset-year"></span>
            <span id="dataset-type"></span>
        </div>
    </div>

    <!-- Party Filter Control -->
    <div class="party-filter-control" style="display: none;">
        <label>Party Filter:</label>
        <div class="party-filter-buttons">
            <button class="party-filter-btn active" data-filter="all">
                Show All
            </button>
            <button class="party-filter-btn" data-filter="republican">
                <span class="party-indicator red"></span>
                Republican Only
            </button>
            <button class="party-filter-btn" data-filter="democratic">
                <span class="party-indicator blue"></span>
                Democratic Only
            </button>
        </div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Info Strip -->
    <div class="info-strip">
        Using publicly available data from <a href="https://www.hidalgocounty.us/3339/Unofficial-Early-Voting-Totals-Rosters" target="_blank">Hidalgo County</a> & <a href="https://cameroncountytx.gov/elections/results/" target="_blank">Cameron County</a> Elections Department. <span id="total-addresses">Loading...</span> out of <span id="total-voters">446,749</span> Hidalgo County voters (<span id="percentage">0.00</span>%) as of <span id="last-updated">Loading...</span>.
    </div>
    
    <!-- JavaScript Files -->
    <script src="map.js"></script>
    <script src="search.js"></script>
    <script src="data.js"></script>
    <script src="metadata.js"></script>
    
    <!-- Initialize welcome popup fade -->
    <script>
        setTimeout(() => {
            const headerBackground = document.querySelector('.header-background');
            const instructionText = document.querySelector('.instruction-text');
            
            if (headerBackground) headerBackground.classList.add('fade-out');
            if (instructionText) instructionText.classList.add('fade-out');
        }, 10000);
    </script>
</body>
</html>
