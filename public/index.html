<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Politiquera.Com - Voting & Election Info</title>

    <!-- Social Media Meta Tags -->
    <meta property="og:title" content="Politiquera.Com - RGV Voting & Election Info">
    <meta property="og:description" content="Look up your neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <meta property="og:image" content="assets/thumbnail.jpg">
    <meta property="og:url" content="https://politiquera.com">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Politiquera.Com - Voting & Election Info">
    <meta name="twitter:description" content="Look up your RGV neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <meta name="twitter:image" content="assets/x-card.jpg">
    
    <!-- Standard Meta Tags -->
    <meta name="description" content="Look up your RGV neighborhood and see who hasn't voted yet - maybe they need a ride or some info!">
    <link rel="image_src" href="assets/thumbnail.jpg">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/thumbnail.jpg">
    
    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    
    <!-- Leaflet Marker Cluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    
    <!-- Leaflet Marker Cluster JS -->
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    
    <!-- Leaflet Heat -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>    

    <!-- USA Flag Icon Marker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css" />

    <style>
        /* District Control Styles */
        .district-control {
            padding: 10px;
            background: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            background-clip: padding-box;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .layer-control-box {
            padding: 6px 8px;
        }

        .layer-control-box h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            color: #333;
            font-weight: bold;
        }

        .control-toggle {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 20px;
            margin-right: 10px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .4s;
        }

        .slider.round {
            border-radius: 20px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #2196F3;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        .opacity-control {
            margin-top: 10px;
        }

        .opacity-control label {
            display: block;
            margin-bottom: 5px;
            color: #666;
            font-size: 12px;
        }

        .opacity-control input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        #opacity-value {
            display: inline-block;
            width: 40px;
            text-align: right;
            font-size: 12px;
            color: #666;
        }

        .districts-legend {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .districts-legend h5 {
            margin: 0 0 5px 0;
            font-size: 12px;
            color: #666;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 2px 0;
            font-size: 11px;
            color: #666;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border: 1px solid rgba(0,0,0,0.2);
        }

        /* Map container style */
        #map {
            height: 100vh;
            width: 100%;
            z-index: 1;
        }

        /* Ensure popups appear above other elements */
        .leaflet-popup {
            z-index: 1000;
        }
    </style>

    <!-- Config file -->
    <script src="config.js"></script>
</head>
<body>   
    <!-- Header Background Gradient -->
    <div class="header-background"></div>
    
    <img src="assets/politiquera.png" alt="Overlay" class="overlay-image">
    
    <!-- Welcome Popup -->
    <div class="welcome-popup" id="welcomePopup">
        <button class="close-button" onclick="document.getElementById('welcomePopup').style.display='none'">×</button>
        Welcome to Politiquera.com! This map shows you who has early-voted in Hidalgo & Cameron County according to their voter turnout rosters. Use this to see who's voted in your City, Community or on your block. If they haven't voted, you can use this as a conversation starter to encourage them to get out and vote! Thanks for visiting!
    </div>

    <!-- Search is now created dynamically by search.js as a bottom-left popup -->

    <!-- Map Options Panel - Top Right -->
    <div class="map-options-panel">
        <div class="map-options-header">
            <h3>Map Options</h3>
            <button class="map-options-toggle" id="mapOptionsToggle">▼</button>
        </div>
        <div class="map-options-content" id="mapOptionsContent">
            <!-- Heatmap Type -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-label" style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Heatmap Type:</label>
                <div class="map-option-buttons" style="display: flex; gap: 8px;">
                    <button class="map-option-btn active" data-option="heatmap" data-value="traditional">
                        Turnout
                    </button>
                    <button class="map-option-btn" data-option="heatmap" data-value="party">
                        Party
                    </button>
                </div>
            </div>

            <!-- Numeric Displays -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="numericDisplayToggle" checked style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show Numeric Badges</span>
                </label>
            </div>

            <!-- Precinct Lines -->
            <div class="map-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="precinctLinesToggle" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Draw Precinct Lines</span>
                </label>
            </div>

            <!-- County Boundaries -->
            <!-- County Boundaries -->
            <div class="map-option-section" style="margin-bottom: 0; padding-bottom: 0;">
                <label class="map-option-checkbox" style="display: flex; align-items: center; cursor: pointer; font-size: 14px; color: #333;">
                    <input type="checkbox" id="countyBoundariesToggle" style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;">
                    <span>Show County Boundaries</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Data Options Panel - Middle Right -->
    <div class="data-options-panel">
        <div class="data-options-header">
            <h3>Data Options</h3>
            <button class="data-options-toggle" id="dataOptionsToggle">▼</button>
        </div>
        <div class="data-options-content" id="dataOptionsContent">
            <!-- Dataset Selector -->
            <div class="data-option-section" style="margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label for="dataset-selector-inline" style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Dataset:</label>
                <select id="dataset-selector-inline" class="dataset-select" style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 13px; background: white; cursor: pointer;">
                    <option value="">Loading datasets...</option>
                </select>
                <div class="dataset-info-inline" style="display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; font-size: 11px;">
                    <span id="dataset-county-inline" style="padding: 3px 6px; background: #f0f0f0; border-radius: 4px; color: #666; font-weight: 500;"></span>
                    <span id="dataset-year-inline" style="padding: 3px 6px; background: #f0f0f0; border-radius: 4px; color: #666; font-weight: 500;"></span>
                    <span id="dataset-type-inline" style="padding: 3px 6px; background: #f0f0f0; border-radius: 4px; color: #666; font-weight: 500;"></span>
                </div>
            </div>

            <!-- Party Filter -->
            <div class="party-filter-section" id="partyFilterSection" style="display: none; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                <label style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Party Filter:</label>
                <div class="party-filter-buttons-inline" style="display: flex; flex-direction: column; gap: 6px;">
                    <button class="party-filter-btn-inline active" data-filter="all">
                        Show All
                    </button>
                    <button class="party-filter-btn-inline" data-filter="republican">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #DC143C; margin-right: 6px;"></span>
                        Republican Only
                    </button>
                    <button class="party-filter-btn-inline" data-filter="democratic">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #1E90FF; margin-right: 6px;"></span>
                        Democratic Only
                    </button>
                </div>
            </div>

            <!-- Flipped Voters Filter -->
            <div class="flipped-voters-section" style="margin-bottom: 0; padding-bottom: 0;">
                <label style="display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 8px;">Flipped Voters:</label>
                <div class="flipped-voters-buttons" style="display: flex; flex-direction: column; gap: 6px;">
                    <button class="flipped-voters-btn active" data-flip="none">
                        Show All
                    </button>
                    <button class="flipped-voters-btn" data-flip="to-blue">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #9370DB; margin-right: 6px;"></span>
                        Flipped Blue (R→D)
                    </button>
                    <button class="flipped-voters-btn" data-flip="to-red">
                        <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background-color: #800000; margin-right: 6px;"></span>
                        Flipped Red (D→R)
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dataset Selector Control - HIDDEN (moved to Data Options panel) -->
    <div class="dataset-selector-control" style="display: none;">
        <label for="dataset-selector">Dataset:</label>
        <select id="dataset-selector" class="dataset-select">
            <option value="">Loading datasets...</option>
        </select>
        <div class="dataset-info">
            <span id="dataset-county"></span>
            <span id="dataset-year"></span>
            <span id="dataset-type"></span>
        </div>
    </div>

    <!-- Dataset Selector Control - HIDDEN (moved to Data Options panel) -->
    <div class="dataset-selector-control" style="display: none;">
        <label for="dataset-selector">Dataset:</label>
        <select id="dataset-selector" class="dataset-select">
            <option value="">Loading datasets...</option>
        </select>
        <div class="dataset-info">
            <span id="dataset-county"></span>
            <span id="dataset-year"></span>
            <span id="dataset-type"></span>
        </div>
    </div>

    <!-- Party Filter Control - HIDDEN (moved to Data Options panel) -->
    <div class="party-filter-control" style="display: none;">
        <label>Party Filter:</label>
        <div class="party-filter-buttons">
            <button class="party-filter-btn active" data-filter="all">
                Show All
            </button>
            <button class="party-filter-btn" data-filter="republican">
                <span class="party-indicator red"></span>
                Republican Only
            </button>
            <button class="party-filter-btn" data-filter="democratic">
                <span class="party-indicator blue"></span>
                Democratic Only
            </button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="map-loading-indicator" class="map-loading-indicator" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading map data...</div>
    </div>

    <!-- Map Container -->
    <div id="map"></div>

    <!-- Info Strip -->
    <div class="info-strip">
        Using publicly available data from <a href="https://www.hidalgocounty.us/3339/Unofficial-Early-Voting-Totals-Rosters" target="_blank">Hidalgo County</a> & <a href="https://cameroncountytx.gov/elections/results/" target="_blank">Cameron County</a> Elections Department. <span id="total-addresses">Loading...</span> out of <span id="total-voters">446,749</span> Hidalgo County voters (<span id="percentage">0.00</span>%) as of <span id="last-updated">Loading...</span>.
    </div>
    
    <!-- JavaScript Files -->
    <script src="map.js"></script>
    <script src="search.js"></script>
    <script src="data.js"></script>
    <script src="ui.js"></script>
    
    <!-- Initialize welcome popup fade -->
    <script>
        setTimeout(() => {
            const welcomePopup = document.getElementById('welcomePopup');
            
            if (welcomePopup) {
                welcomePopup.style.transition = 'opacity 2s ease';
                welcomePopup.style.opacity = '0';
                setTimeout(() => {
                    welcomePopup.style.display = 'none';
                }, 2000); // Hide after fade completes
            }
        }, 10000);
    </script>
</body>
</html>
